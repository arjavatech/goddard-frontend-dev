<html>
    <head>
        <title>Add Class Room</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="../image/gs_logo_tab.png" type="image/png">
        <link rel="stylesheet" href="../css/navbar_signout_style.css">
        <link rel="stylesheet" href="../css/add_class_room.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <script type="module" src="../js/classroom.js"></script>
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar_bg">
            <div class="text-center">
                <img src="../image/gs_logo_lynnwood.png" alt="gs_logo_lynnwood" type="image/png" width="476px" height="112px">
            </div>
            <div id="btn-signout" class="btn signout"><i class="fa-solid fa-arrow-right-from-bracket"></i>&nbsp;<b>Sign Out</b></div>
        </nav>
        <!-- Navigation Bar End -->

         <!-- Welcome Screen -->
         <div class="p-3">
            <h2 class="parent_dashboard_title h2 pt-4 text-center">Add Class Room</h2>
            <!-- Welcome Text -->
            <h4 class="h4 pt-2 text-center" id="welcomeText" name="welcomeText"></h4>
        </div>
        <!-- Welcome Screen End -->
        <form id="classRoomForm">
            <div class="row">
                <div class="col-4 d-flex justify-content-center">
                    <div class="form-group">
                        <label for="class_name" class="form-label"><b>Class Room Name
                        </b></label><br>
                        <input name="class_name" type="text" maxlength="20" 
                        class="form-control wizard-required" id="class_name">
                    </div>
                </div>
                <div class="col-1 mt-4">
                    <button  class="classroom-add-btn" id="classroonbtn">Add</button>
                </div>
                <div class="col-6 d-flex justify-content-center">
                    <div class="search-container">
                        <input type="text" id="searchInput" class=" search-input" 
                        placeholder="Search the content...">
                        <div class="search-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg></div> 
                    </div>
                </div>
            </div>
        </form>
        <div class="d-flex justify-content-center">
            <div class="container" style="margin-top: 20px;">
                <div class="table-wrapper">
                    <!-- Form Action Table -->
                    <table id="example" class="display nowrap" style="width:100%" frame ="box" rules ="all">  
                        <thead>
                            <tr>
                                <th>Class Room</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <!-- Form Action Table End -->
                </div>
            
                <div class="position-relative p-4">
                    <div class="position-absolute top-50 start-50 translate-middle">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-end">
                                <li class="page-item disabled" id="prevPage">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item" id="nextPage">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
        <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.datatables.net/rss.xml">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/searchbuilder/1.3.2/css/searchBuilder.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/datetime/1.1.2/css/dataTables.dateTime.min.css">

        <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
        <script>
            $(document).ready(function () {

                //for avoid datatable error popup messages//
                $.fn.dataTable.ext.errMode = 'none';

                //datatable creating function//
                $('#example').DataTable({
                    //for adding horizontal scrool bar
                    scrollX: true,
                    Info : false,
                    //option is used to define the layout and elements that should be displayed around the table.
                    dom: 'Qlfrtip',
                    //for waking up the aws lambda server
                    ajax: {
                        url:'http://localhost:8080/ClassId_ClassName_info/all',
                        dataSrc: '',
                    },
                    //it is used to define and configure the individual columns of the table.
                    columns: [
                        { data: 'class_name'},
                        { data: 'edit',
                            render: function ( data, type, full, meta ) {
                                window.location.replace = `${window.location.origin}/admin/addclassroom.html?id=${full.class_id} `;
                                let url =`${window.location.origin}/admin/addclassroom.html?id=${full.class_id}` //Question
                               return '<a href="'+ url +'"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9RvaUyBbAGaB9dcdAZxQvJJHKnd8vqQpsqgJpRuNrFCwk2ZY5vl5RgEj_b2wcGXW8OwE&usqp=CAU" id="editbutton"  name="editbutton"  height="20px;" style="text-align:right !important;"><img src="https://cdn-icons-png.flaticon.com/512/1345/1345874.png" id="deletebutton"  name="deletebutton"  height="20px;" style="text-align:right !important;cursor: pointer !important;"></a>';
                            },
                        },
                        // { data: 'delete',
                        //     //frameworks that allow you to customize the rendering or display of data within a table.
                        //     render: function ( data, type, full, meta ) {
                        //         return '<img src="https://cdn-icons-png.flaticon.com/512/1345/1345874.png" id="deletebutton"  name="deletebutton"  height="20px;" style="text-align:right !important;cursor: pointer !important;">';
                        //     }
                        // },
                    ],
                    "pageLength": 5,
                });
            });
        </script>
        <script>
            let editID = window.location.search.slice(4);
            if(editID != ''){
                //for waking up the aws lambda server
                $.ajax({
                    url: `http://localhost:8080/ClassId_ClassName_info/fetch/${editID}`,
                    type: 'get',
                    //this is uesd to get the response and return the result
                    success: function(response){
                        console.log(response);
                        if (typeof response.class_name !== "undefined")
                        document.getElementsByName('class_name')[0].value = response.class_name;
                        //to set all response value into local storage variable
                        window.localStorage.setItem("responseClassDetails",JSON.stringify(response));
                    }
                });
                //to get values from local storage variable.
                console.log(window.localStorage.getItem("responseClassDetails"));
                var form = document.getElementById("classRoomForm");
                var old = form;
                //The cloneNode() method allows you to create a duplicate of an existing DOM element
                var new_element = old.cloneNode(true);
                //replace the element
                old.parentNode.replaceChild(new_element,old);
                new_element.addEventListener("submit", (e) => {
                    e.preventDefault();
                    //to get form data values
                    const formData = new FormData(e.target);
                    const obj = Object.fromEntries(formData);
                    console.log(obj);
                    //to get values from local storage variable and stored it into response1 variable.
                    var response1=JSON.parse(window.localStorage.getItem("responseClassDetails"));
                    console.log(response1);
                    //to set local response variable id value for obj id value.
                    obj.class_id = response1.class_id;
                    console.log(obj)
                    const json=JSON.stringify(obj);
                    console.log(json);
                    
                    var msg = confirm("Are you sure?");      
                    if (msg == true) {  
                    //  sending post request to the server
                        let xhr = new XMLHttpRequest();
                        xhr.onload = () => {
                            const data = xhr.responseText;
                            if (xhr.status == 200) {
                                var confirmationRes = window.confirm(data);
                                if (confirmationRes) {
                                    // window.location.href = "../reg_form/student.html";
                                    window.location.reload();
                                } else {
                                    window.location.href = "../admin/addclassroom.html";
                                }
                            }       
                        };

                        xhr.open("PUT", 'http://localhost:8080/ClassId_ClassName_info/update');
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.send(json);
                    }
                });
            }
        </script>
    </body>
</html>        